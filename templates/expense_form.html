{% extends "base.html" %}
{% block content %}

<div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg mt-10">

  <!-- Title -->
  <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">
    {% if mode|default('add') == "edit" %}
      Edit Expense
    {% else %}
      Add Expense
    {% endif %}
  </h1>

  <form method="POST" class="space-y-5">

    <!-- Date -->
    <div class="flex flex-col">
      <label class="text-gray-700 font-semibold mb-1">Date</label>
      <input type="date" name="date"
             value="{% if mode|default('add') == 'edit' and record %}{{ record.date }}{% else %}{{ current_date|default('') }}{% endif %}"
             class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-{{ color|default('blue') }}-400">
    </div>

    <!-- Category -->
    <div class="flex flex-col">
      <label class="text-gray-700 font-semibold mb-1">Category</label>
      <select name="category"
              class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-{{ color|default('blue') }}-400">
        <option value="">Select Category</option>
        {% for cat in categories|default([]) %}
          <option value="{{ cat }}"
            {% if (mode|default('add') == 'edit' and record and record.category == cat) 
                  or (form_data and form_data.category == cat) %}selected{% endif %}>
            {{ cat }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Amount -->
    <div class="flex flex-col">
      <label class="text-gray-700 font-semibold mb-1">Amount</label>
      <input type="number" step="0.01" name="amount"
             value="{% if mode|default('add') == 'edit' and record %}{{ record.amount }}{% elif form_data %}{{ form_data.amount }}{% else %}{{ '' }}{% endif %}"
             placeholder="Enter amount in MMK"
             class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-{{ color|default('blue') }}-400">
    </div>

    <!-- Description -->
    <div class="flex flex-col">
      <label class="text-gray-700 font-semibold mb-1">Description</label>
      <input type="text" name="description"
             value="{% if mode|default('add') == 'edit' and record %}{{ record.description }}{% elif form_data %}{{ form_data.description }}{% else %}{{ '' }}{% endif %}"
             placeholder="Optional note"
             class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-{{ color|default('blue') }}-400">
    </div>

    <!-- Confirm Warning (only for Expense if needed) -->
    {% if show_confirm|default(False) %}
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded shadow-inner">
      <p class="text-yellow-800 font-semibold mb-2">
        ⚠ Warning: This will use all your remaining balance.
      </p>
      <label class="flex items-center gap-2 text-gray-700">
        <input type="checkbox" name="confirm" value="yes" class="w-4 h-4 border-gray-300 rounded" required>
        Yes, I understand and want to continue
      </label>
    </div>
    {% endif %}

    <!-- Submit Button -->
    <button type="submit"
            class="w-full py-2 rounded-lg font-semibold text-white shadow-md
            {% if mode|default('add') == 'edit' %}bg-blue-500 hover:bg-blue-600{% else %}bg-{{ color|default('blue') }}-500 hover:bg-{{ color|default('blue') }}-600{% endif %} transition-colors">
      {% if mode|default('add') == "edit" %}
        Update Expense
      {% else %}
        Add Expense
      {% endif %}
    </button>

  </form>

  <!-- Back Link -->
  <p class="mt-6 text-center">
    <a href="{{ url_for('dashboard') }}"
       class="text-blue-500 hover:text-blue-700 font-medium transition-colors">
       ← Back to Dashboard
    </a>
  </p>

</div>

{% endblock %}