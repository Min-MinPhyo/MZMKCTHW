{% extends "base.html" %}
{% block content %}
<div id="toast-container" class="fixed top-5 right-5 z-[100] flex flex-col gap-3"></div>

<div id="custom-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-[2rem] max-w-sm w-full p-8 shadow-2xl scale-95 transition-transform duration-300" id="modal-content">
        <div class="text-center">
            <div class="w-16 h-16 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h3 class="text-xl font-black text-gray-900 dark:text-white mb-2" data-t="confirmTitle">Confirm Delete</h3>
            <p class="text-gray-500 dark:text-gray-400 text-sm mb-6" data-t="deleteConfirm">Are you sure you want to delete this goal?</p>
            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 px-4 py-3 rounded-xl font-bold text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 transition" data-t="cancelBtn">Cancel</button>
                <a id="confirm-delete-link" href="#" class="flex-1 px-4 py-3 rounded-xl font-bold text-white bg-red-500 hover:bg-red-600 shadow-lg shadow-red-200 dark:shadow-none transition text-center" data-t="deleteBtn">Delete</a>
            </div>
        </div>
    </div>
</div>

<div class="max-w-4xl mx-auto px-4 py-10 space-y-10 animate-fade-in">
    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <h1 class="text-4xl font-black text-gray-900 dark:text-white tracking-tight" data-t="title">Savings Goals üéØ</h1>
            <p class="text-gray-500 dark:text-gray-400 font-medium" data-t="subtitle">Plan your future and track your progress.</p>
        </div>
        <a href="{{ url_for('dashboard') }}" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 px-6 py-2.5 rounded-xl font-bold text-sm shadow-sm transition flex items-center gap-2 dark:text-white">
            <span>‚Üê</span> <span data-t="dashboard">Dashboard</span>
        </a>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-[2.5rem] shadow-2xl shadow-blue-900/5 p-8 border border-gray-100 dark:border-gray-700 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-blue-50 dark:bg-blue-900/20 rounded-full -mr-16 -mt-16 opacity-50"></div>
        <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6 flex items-center gap-2">
            <span class="w-2 h-6 bg-blue-600 rounded-full"></span>
            <span data-t="createNew">Create New Goal</span>
        </h2>

        <form method="POST" id="addGoalForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
            <input type="hidden" name="add_goal">
            <div class="space-y-2">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1" data-t="goalName">Goal Name</label>
                <input type="text" name="goal_name" id="input_goal_name" class="w-full p-4 bg-gray-50 dark:bg-gray-900 border-2 border-transparent rounded-2xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900 outline-none transition dark:text-white" required>
            </div>
            <div class="space-y-2">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1" data-t="targetAmount">Target (MMK)</label>
                <input type="number" name="target_amount" placeholder="500,000" min="1" class="w-full p-4 bg-gray-50 dark:bg-gray-900 border-2 border-transparent rounded-2xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900 outline-none transition dark:text-white" required>
            </div>
            <div class="md:col-span-2">
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl shadow-lg shadow-blue-200 transition transform active:scale-[0.98]" data-t="setGoal">
                    SET SAVINGS GOAL
                </button>
            </div>
        </form>
    </div>

    <div class="grid grid-cols-1 gap-8">
        {% for goal in goals %}
            {% set current = goal[4] %}
            {% set target = goal[3] %}
            {% set pct = (current / target * 100) | round | int if target > 0 else 0 %}
            {% set display_pct = 100 if pct > 100 else pct %}

        <div class="bg-white dark:bg-gray-800 rounded-[2.5rem] shadow-lg p-8 border border-gray-50 dark:border-gray-700 transition hover:shadow-xl group relative overflow-hidden">
            {% if current >= target %}
            <div class="absolute -top-1 -right-1 w-24 h-24">
                <div class="bg-green-500 text-white text-[9px] font-black py-1 px-10 transform rotate-45 translate-x-4 translate-y-4 shadow-sm text-center" data-t="done">DONE</div>
            </div>
            {% endif %}

            <div class="flex justify-between items-start mb-6">
                <div class="space-y-1">
                    <h3 class="text-2xl font-black text-gray-800 dark:text-white group-hover:text-blue-600 transition">{{ goal[2] }}</h3>
                    <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">
                        <span data-t="targetLabel">Target</span>: {{ "{:,.0f}".format(target) }} MMK
                    </p>
                </div>
                <button onclick="handleDelete('{{ url_for('delete_goal', goal_id=goal[0]) }}')" class="w-10 h-10 flex items-center justify-center rounded-xl bg-red-50 dark:bg-red-900/20 text-red-400 hover:bg-red-500 hover:text-white transition shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
            </div>

            <div class="relative pt-1">
                <div class="flex mb-2 items-center justify-between">
                    <span class="text-xs font-black px-3 py-1 rounded-full {{ 'text-green-700 bg-green-100' if current >= target else 'text-blue-600 bg-blue-50' }}">
                        {{ display_pct }}% <span data-t="progress">Progress</span>
                    </span>
                    <span class="text-sm font-bold text-gray-600 dark:text-gray-300">{{ "{:,.0f}".format(current) }} MMK <span data-t="saved">saved</span></span>
                </div>
                <div class="overflow-hidden h-4 mb-4 flex rounded-full bg-gray-100 dark:bg-gray-700 border border-gray-50 dark:border-gray-600 shadow-inner">
                    <div style="width: {{ display_pct }}%" class="transition-all duration-1000 ease-out {{ 'bg-green-500' if current >= target else 'bg-blue-600' }}"></div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-900 rounded-2xl border border-gray-100 dark:border-gray-700">
                <form method="POST" class="updateGoalForm flex flex-col sm:flex-row items-center gap-4">
                    <input type="hidden" name="update_amount">
                    <input type="hidden" name="goal_id" value="{{ goal[0] }}">
                    <div class="flex-1 w-full">
                        <label class="text-[10px] font-black text-gray-400 uppercase block mb-1" data-t="updateLabel">Update Current Savings</label>
                        <input type="number" name="current_amount" value="{{ current }}" min="0" max="{{ target }}" class="w-full px-4 py-2.5 rounded-xl border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 font-black text-gray-700 dark:text-white focus:border-blue-500 outline-none transition" required>
                    </div>
                    <button type="submit" class="w-full sm:w-auto bg-gray-900 dark:bg-blue-600 text-white px-8 py-3 rounded-xl font-bold text-sm hover:bg-blue-600 transition shadow-lg active:scale-95 self-end" data-t="updateBtn">UPDATE</button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="text-center py-24 bg-white dark:bg-gray-800 rounded-[3rem] border-4 border-dashed border-gray-100 dark:border-gray-700">
            <div class="text-6xl mb-4">üåü</div>
            <p class="text-gray-400 font-bold text-lg italic" data-t="noGoals">No savings goals yet. Start dreaming!</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    const translations = {
        "en": {
            "title": "Savings Goals üéØ",
            "subtitle": "Plan your future and track your progress.",
            "dashboard": "Dashboard",
            "createNew": "Create New Goal",
            "goalName": "Goal Name",
            "placeholderName": "e.g. New Laptop",
            "targetAmount": "Target (MMK)",
            "setGoal": "SET SAVINGS GOAL",
            "targetLabel": "Target",
            "progress": "Progress",
            "saved": "saved",
            "updateLabel": "Update Current Savings",
            "updateBtn": "UPDATE",
            "noGoals": "No savings goals yet. Start dreaming!",
            "confirmTitle": "Confirm Delete",
            "deleteConfirm": "Are you sure you want to delete this goal?",
            "cancelBtn": "Cancel",
            "deleteBtn": "Delete",
            "addSuccess": "Goal created successfully!",
            "updateSuccess": "Savings updated successfully!",
            "done": "DONE"
        },
        "mm": {
            "title": "·ÄÖ·ÄØ·ÄÑ·ÄΩ·Ä±·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ üéØ",
            "subtitle": "·Äû·ÄÑ·Ä∑·Ä∫·Ä°·Äî·Ä¨·ÄÇ·Äê·Ä∫·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·ÄÖ·Äî·ÄÖ·Ä∫·Äê·ÄÄ·Äª ·ÄÖ·ÄØ·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Åã",
            "dashboard": "·Äï·ÄÑ·Ä∫·Äô·ÄÖ·Ä¨·Äô·Äª·ÄÄ·Ä∫·Äî·Äæ·Ä¨",
            "createNew": "·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫",
            "goalName": "·Ä°·Äô·Ää·Ä∫",
            "placeholderName": "·Ä•·Äï·Äô·Ä¨ - ·ÄÄ·ÄΩ·Äî·Ä∫·Äï·Äª·Ä∞·Äê·Ä¨·Ä°·Äû·ÄÖ·Ä∫",
            "targetAmount": "·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äï·Äô·Ä¨·Äè (·ÄÄ·Äª·Äï·Ä∫)",
            "setGoal": "·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·Äô·Ää·Ä∫",
            "targetLabel": "·Äï·Äô·Ä¨·Äè",
            "progress": "·Äê·Ä≠·ÄØ·Ä∏·Äê·ÄÄ·Ä∫·Äô·Äæ·ÄØ",
            "saved": "·ÄÖ·ÄØ·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏",
            "updateLabel": "·ÄÖ·ÄØ·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äô·Ä≠·Äû·Ä±·Ä¨ ·Äï·Äô·Ä¨·Äè·ÄÄ·Ä≠·ÄØ·Äï·Äº·ÄÑ·Ä∫·Äõ·Äî·Ä∫",
            "updateBtn": "·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äô·Ää·Ä∫",
            "noGoals": "·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´·Åã ·Ä°·ÄÅ·ÄØ·Äï·Ä≤ ·ÄÖ·Äê·ÄÑ·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´·Åã",
            "confirmTitle": "·Äñ·Äª·ÄÄ·Ä∫·Äõ·Äî·Ä∫ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?",
            "deleteConfirm": "·Ä§·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äõ·Äî·Ä∫ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?",
            "cancelBtn": "·Äô·Äñ·Äª·ÄÄ·Ä∫·Äê·Ä±·Ä¨·Ä∑·Äï·Ä´",
            "deleteBtn": "·Äñ·Äª·ÄÄ·Ä∫·Äô·Ää·Ä∫",
            "addSuccess": "·Äõ·Ää·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äû·ÄÖ·Ä∫ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã",
            "updateSuccess": "·ÄÖ·ÄØ·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÑ·ÄΩ·Ä±·Äï·Äô·Ä¨·Äè·ÄÄ·Ä≠·ÄØ ·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã",
            "done": "·Äï·Äº·ÄÆ·Ä∏·Äï·Äº·ÄÆ"
        }
    };

    function getLang() { return document.documentElement.lang === 'my' ? 'mm' : 'en'; }

    function applyTranslations() {
        const lang = getLang();
        const t = translations[lang];
        document.querySelectorAll('[data-t]').forEach(el => {
            const key = el.getAttribute('data-t');
            if (t[key]) el.textContent = t[key];
        });
        const nameInput = document.getElementById('input_goal_name');
        if (nameInput) nameInput.placeholder = t['placeholderName'];
    }

    // --- MODERN ALERT (TOAST) ---
    function showToast(message) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = "bg-gray-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 animate-slide-in pointer-events-auto border border-gray-700";
        toast.innerHTML = `<span class="text-green-400">‚úî</span> <span class="font-bold text-sm">${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => {
            toast.classList.add('animate-fade-out');
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    }

    // --- MODERN CONFIRMATION (MODAL) ---
    function handleDelete(url) {
        const modal = document.getElementById('custom-modal');
        const link = document.getElementById('confirm-delete-link');
        link.href = url;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        setTimeout(() => document.getElementById('modal-content').classList.remove('scale-95'), 10);
    }

    function closeModal() {
        const modal = document.getElementById('custom-modal');
        document.getElementById('modal-content').classList.add('scale-95');
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 200);
    }

    // Form Interceptors
    document.getElementById('addGoalForm').onsubmit = function(e) {
        const lang = getLang();
        showToast(translations[lang]['addSuccess']);
        // Form submits naturally after toast triggers
    };

    document.querySelectorAll('.updateGoalForm').forEach(form => {
        form.onsubmit = function(e) {
            const lang = getLang();
            showToast(translations[lang]['updateSuccess']);
        };
    });

    document.addEventListener('DOMContentLoaded', applyTranslations);
</script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Padauk:wght@400;700&display=swap');
    
    body { font-family: 'Plus Jakarta Sans', 'Padauk', sans-serif; background-color: #f8fafc; }
    .dark body { background-color: #0f172a; }

    /* Animations */
    @keyframes slide-in { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes fade-out { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.9); } }
    @keyframes fade-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .animate-slide-in { animation: slide-in 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    .animate-fade-out { animation: fade-out 0.4s forwards; }
    .animate-fade-in { animation: fade-in 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
</style>
{% endblock %}