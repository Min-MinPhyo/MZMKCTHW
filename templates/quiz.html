{% extends "base.html" %}
{% block content %}

<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-50 px-4 py-10">

  <div class="max-w-lg w-full bg-white rounded-3xl shadow-2xl p-8 relative overflow-hidden">
    
    <div class="text-center mb-6">
      <h2 class="text-3xl font-extrabold text-gray-800">
        {{ t("play_quiz") }}
      </h2>
      <p class="text-gray-500 font-medium mt-1">
        {{ t("records") }} : {{ current }} / {{ total }}
      </p>
    </div>

    <div class="flex justify-center mb-6">
      <div class="flex items-center gap-2 px-6 py-2 bg-red-50 border border-red-200 text-red-600 font-bold rounded-full shadow-sm {% if remaining_time < 10 %}animate-pulse{% endif %}">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span id="timer">{{ remaining_time }}</span>s
      </div>
    </div>

    <div class="bg-blue-50 rounded-2xl p-6 mb-8 shadow-inner border border-blue-100 text-center">
      <h3 class="text-xl font-bold text-gray-800 leading-relaxed">
        {{ t(question.question, is_user_data=True) }}
      </h3>
    </div>

    <form method="POST" id="quizForm" class="space-y-4">
      {% for opt in question.options %}
      <label class="group flex items-center gap-4 p-4 rounded-2xl border-2 border-gray-100 cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 shadow-sm">
        <input type="radio" name="option" value="{{ opt }}" required 
               class="w-5 h-5 accent-blue-600 group-hover:scale-110 transition-transform">
        <span class="font-semibold text-gray-700 group-hover:text-blue-700">
          {{ t(opt, is_user_data=True) }}
        </span>
      </label>
      {% endfor %}

      <div class="mt-8 space-y-4">
        <div class="flex flex-col sm:flex-row gap-4">
          <button type="submit"
                  class="flex-1 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-2xl shadow-lg hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl transform active:scale-95 transition-all duration-200 flex justify-center items-center gap-2">
            <span>{{ t("next") }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>

          <a href="{{ url_for('quiz_quit') }}"
             class="flex-1 py-4 bg-gray-100 text-gray-600 font-bold rounded-2xl border border-gray-200 hover:bg-gray-200 hover:text-gray-800 text-center transition-all duration-200">
            {{ t("cancel") }}
          </a>
        </div>

        {% if current > 1 %}
        <div class="flex justify-center">
          <a href="{{ url_for('quiz_reset') }}"
             class="text-sm font-bold text-red-500 hover:text-red-700 underline underline-offset-4 decoration-2 transition-colors">
            ðŸ”„ {{ t("reset") }}
          </a>
        </div>
        {% endif %}
      </div>
    </form>

    {% set percent = (current / total) * 100 %}
    <div class="mt-10">
      <div class="flex justify-between text-xs font-bold text-gray-400 mb-2 uppercase tracking-widest">
        <span>Progress</span>
        <span>{{ percent|round(0)|int }}%</span>
      </div>
      <div class="h-3 bg-gray-100 rounded-full overflow-hidden shadow-inner">
        <div class="h-3 bg-gradient-to-r from-green-400 via-blue-500 to-indigo-600 shadow-sm transition-all duration-500"
             style="width: {{ percent }}%"></div>
      </div>
    </div>

  </div>
</div>

<script>
  let timeLeft = {{ remaining_time }};
  const timerEl = document.getElementById("timer");
  const form = document.getElementById("quizForm");

  const countdown = setInterval(() => {
    if (timeLeft <= 0) {
      clearInterval(countdown);
      // Remove required to avoid validation popup blocking auto-submit
      const inputs = form.querySelectorAll('input[type="radio"]');
      inputs.forEach(input => input.required = false);
      form.submit();
      return;
    }
    timeLeft--;
    timerEl.textContent = timeLeft;
  }, 1000);
</script>

{% endblock %}