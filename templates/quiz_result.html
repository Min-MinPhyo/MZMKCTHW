{% extends "base.html" %}
{% block content %}

<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-50 px-4 py-10">

    <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden relative p-6">

        <!-- Header with confetti effect -->
        <div class="text-center mb-6 relative">
            <h2 class="text-4xl font-extrabold text-gray-800 mb-1 animate__animated animate__fadeInDown">ğŸ Quiz Result</h2>
            <p class="text-gray-500 text-lg animate__animated animate__fadeInDown animate__delay-1s">
                See how well you did!
            </p>

            <!-- Confetti Canvas -->
            <canvas id="confetti-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>
        </div>

        <!-- Animated Score Circle -->
        <div class="flex justify-center mb-6">
            <div class="w-36 h-36 rounded-full border-8 border-gray-200 flex items-center justify-center relative shadow-lg">
                <div class="absolute inset-0 flex items-center justify-center">
                    <svg class="w-36 h-36 transform -rotate-90" viewBox="0 0 36 36">
                        <circle class="text-gray-300" stroke-width="4" stroke="currentColor" fill="none" cx="18" cy="18" r="16"></circle>
                        <circle class="text-blue-500" stroke-width="4" stroke-linecap="round" fill="none" cx="18" cy="18" r="16"
                                stroke-dasharray="100"
                                stroke-dashoffset="{{ 100 - (score / total * 100) }}">
                        </circle>
                    </svg>
                </div>
                <div class="relative text-center">
                    <p class="text-4xl font-bold text-blue-600">{{ score }}</p>
                    <p class="text-sm text-gray-500">/ {{ total }}</p>
                </div>
            </div>
        </div>

        <!-- Feedback Message -->
        <div class="text-center text-xl font-semibold mb-6 animate__animated animate__fadeInUp">
            {% if score == total %}
                ğŸ‰ <span class="text-green-600">Excellent! Perfect Score!</span>
            {% elif score >= total // 2 %}
                ğŸ‘ <span class="text-blue-600">Good job! Keep going!</span>
            {% else %}
                ğŸ’ª <span class="text-red-500">Keep practicing! Youâ€™ll improve!</span>
            {% endif %}
        </div>

        <!-- Progress Bar -->
        {% set percent = (score / total) * 100 %}
        <div class="w-full bg-gray-200 h-4 rounded-full overflow-hidden mb-6 animate__animated animate__fadeInUp animate__delay-1s">
            <div class="h-4 bg-gradient-to-r from-green-400 to-blue-500 transition-all duration-700"
                 style="width: {{ percent }}%"></div>
        </div>
        <p class="text-center text-sm text-gray-500 mb-6">{{ percent|round(0) }}% correct</p>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center animate__animated animate__fadeInUp animate__delay-2s">
            <a href="{{ url_for('quiz_reset') }}"
               class="px-6 py-3 rounded-xl bg-blue-600 text-white font-semibold shadow-lg hover:bg-blue-700 hover:scale-105 transition-all">
               ğŸ” Play Again
            </a>

            <a href="{{ url_for('dashboard') }}"
               class="px-6 py-3 rounded-xl bg-gray-600 text-white font-semibold shadow-lg hover:bg-gray-700 hover:scale-105 transition-all">
               ğŸ  Dashboard
            </a>
        </div>

    </div>

</div>

<!-- Confetti JS -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
    // Trigger confetti for high score
    const score = {{ score }};
    const total = {{ total }};
    if(score === total) {
        const duration = 3 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };

        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();

            if(timeLeft <= 0) {
                return clearInterval(interval);
            }

            const particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0,1), y: Math.random() - 0.2 } }));
        }, 250);
    }
</script>

{% endblock %}
